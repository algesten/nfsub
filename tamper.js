// ==UserScript==
// @name         Netflix Subtitles
// @namespace    http://www.netflix.com
// @version      1.0.8
// @description  subtitles on netflix
// @author       Martin Algesten
// @match        http://*/*
// @grant        none
// ==/UserScript==

!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.nfsub=e()}}(function(){return function e(t,n,r){function i(u,a){if(!n[u]){if(!t[u]){var l="function"==typeof require&&require;if(!a&&l)return l(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var f=n[u]={exports:{}};t[u][0].call(f.exports,function(e){var n=t[u][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){(function(){var n,r,i,o,u,a,l,f,s,d,c,p,m,v,g,y,h,x,T,b,w,E,L,N,C=[].slice;E=e("subplay"),c=function(e){return document.createElement(e)},u=function(e){var t;return null!=(t=document.getElementsByTagName(e))?t[0]:void 0},i=function(e){var t;return null!=(t=document.getElementsByClassName(e))?t[0]:void 0},o=function(e){return document.getElementById(e)},d=function(){var e,t,n,r,i,o,u;for(o=arguments[0],i=2<=arguments.length?C.call(arguments,1):[],e=0,n=i.length;n>e;e++){r=i[e];for(t in r)u=r[t],void 0!==u&&(o[t]=u)}return o},h=function(e){return/in/.test(document.readyState)?setTimeout(h,9,e):e()},s=function(){var e;return e=1<=arguments.length?C.call(arguments,0):[],console.log.apply(console,e)},a=function(){return u("video")},r=function(){var e,t,n;return(e=i("nfsub"))?e:(n=i("player-timedtext"),e=c("div"),e.className="nfsub",n.parentNode.appendChild(e),e.innerHTML='<div class="nfsub-text"></div>\n<div class="nfsub-offs"></div>',d(e.style,{position:"absolute",bottom:"50px",left:"0",height:"100px",width:"100%",fontSize:"3vw",color:"#fff",textShadow:"-1px -1px 0 #000, 1px -1px 0 #000, -1px  1px 0 #000, 1px  1px 0 #000"}),d(i("nfsub-text").style,{textAlign:"center"}),d(i("nfsub-offs").style,{right:"20px",top:"0",position:"absolute",display:"none"}),t=c("div"),t.className="nfsub-load",t.innerHTML="Load",d(t.style,{position:"absolute",top:"0",right:"0",color:"#fff",padding:"7px",cursor:"pointer"}),setTimeout(function(){var e;return e=o("player-menu-track-settings"),e.appendChild(t),i("nfsub-load").addEventListener("click",g)},1e3),document.body.addEventListener("keydown",v),s("attachDom appended",e),e)},g=function(e){var t;return s("onLoadClick",e),e.preventDefault(),e.stopPropagation(),t=c("input"),t.type="file",t.addEventListener("change",x,!1),t.opacity=0,document.body.appendChild(t),t.click()},f=function(e){return e.ctrlKey||e.metaKey||e.shiftKey},m=0,n=50,v=function(e){return f(e)?void 0:71===e.keyCode?(m-=n,w()):72===e.keyCode?(m+=n,w()):void 0},w=function(){var e;return e=i("nfsub-offs"),e.innerHTML=m+"ms",e.style.display="block",e._timeout&&clearTimeout(e._timeout),e._timeout=setTimeout(function(){return e.style.display="none"},1e3)},x=function(e){var t,n,r;return s("readFile",e),(t=null!=(r=e.target.files)?r[0]:void 0)?(n=new FileReader,p.stop(),n.onload=function(t){var n;return s("readFile onload",t),e.target.parentNode.removeChild(e.target),n=t.target.result,p.start(n)},n.readAsText(t,"cp1252")):void 0},l=function(){var e,t,n;return s("start install event listener"),n=null,n&&n.removeEventListener("timeupdate",y),t=function(){return s("installing handler"),clearInterval(e),n.removeEventListener("timeupdate",t),n.addEventListener("timeupdate",y),r()},e=setInterval(function(){return n=a(),n?n.addEventListener("timeupdate",t):void 0},1e3)},s("waiting onready"),h(l),L=null,N=function(){},y=function(e){return N(e.target.currentTime)},T=function(e){return i("nfsub-text").innerHTML=e},b=function(e,t){var n;return n=attach(),n.innerHTML=t},t.exports=p={start:function(e){return L=E(e,T),N=function(e){var t;return L((t=e+m/1e3)>=0?t:0)}},stop:function(){return"function"==typeof L&&L(-1),L=null,N=function(){}}}}).call(this)},{subplay:2}],2:[function(e,t,n){(function(){t.exports=e("./sub")}).call(this)},{"./sub":3}],3:[function(e,t,n){(function(){var n,r,i,o,u,a,l,f,s,d=[].slice;f=e("subtitles-parser"),i=function(){var e;return null!=(e=document.getElementsByTagName("video"))?e[0]:void 0},l=function(){var e,t,n,r,i,o,u;for(o=arguments[0],i=2<=arguments.length?d.call(arguments,1):[],e=0,n=i.length;n>e;e++){r=i[e];for(t in r)u=r[t],void 0!==u&&(o[t]=u)}return o},u=function(e){return"string"==typeof e},o=function(e){return"function"==typeof e},n={millis:!1},r=function(e,t){return null==(null!=t?t.endTime:void 0)||e>(null!=t?t.endTime:void 0)?void 0:t.endTime-e},a=function(e,t,n,i){var o,u,l,f,s,d;return null==i&&(i=!0),o=e[n],u=r(t,o),i&&null!=u&&(s=e[n-1],d=r(t,s),null!=d&&u>d)?a(e,t,0,!1):(l=e[n+1],f=r(t,l),null==u||u>f?a(e,t,n+1,!1):n)},s=function(e,t,r){var i,s,d,c,p;if(null==r&&(r={}),!u(e))throw new Error("Bad srt");if(!o(t))throw new Error("Bad renderer");return r=l({},n,r),s=f.fromSrt(e,!0),d=0,i=null,c=null,p=function(e,n){var o,u,l,f;if(null==n&&(n=r.millis),u=n?e:1e3*e,d=a(s,u,d),o=s[d],f=Date.now(),l=function(e,n,r){return c=setTimeout(function(){return null!==i&&null!==r&&t(""),t(n),i=r,p(u+(Date.now()-f)+5,!0)},e)},c&&clearTimeout(c),0>u);else if(u<o.startTime){if(o!==i)return i&&l(0,"",null),l(o.startTime-u,o.text,o)}else if(u<o.endTime)return i===o?l(o.endTime-u,"",null):l(0,o.text,o)}},t.exports=s}).call(this)},{"subtitles-parser":4}],4:[function(e,t,n){var r=function(){var e={};e.fromSrt=function(e,n){var r=n?!0:!1;e=e.replace(/\r/g,"");var i=/(\d+)\n(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/g;e=e.split(i),e.shift();for(var o=[],u=0;u<e.length;u+=4)o.push({id:e[u].trim(),startTime:r?t(e[u+1].trim()):e[u+1].trim(),endTime:r?t(e[u+2].trim()):e[u+2].trim(),text:e[u+3].trim()});return o},e.toSrt=function(e){if(!e instanceof Array)return"";for(var t="",r=0;r<e.length;r++){var i=e[r];isNaN(i.startTime)||isNaN(i.endTime)||(i.startTime=n(parseInt(i.startTime,10)),i.endTime=n(parseInt(i.endTime,10))),t+=i.id+"\r\n",t+=i.startTime+" --> "+i.endTime+"\r\n",t+=i.text.replace("\n","\r\n")+"\r\n\r\n"}return t};var t=function(e){var t=/(\d+):(\d{2}):(\d{2}),(\d{3})/,n=t.exec(e);if(null===n)return 0;for(var r=1;5>r;r++)n[r]=parseInt(n[r],10),isNaN(n[r])&&(n[r]=0);return 36e5*n[1]+6e4*n[2]+1e3*n[3]+n[4]},n=function(e){var t=[36e5,6e4,1e3],n=[];for(var r in t){var i=(e/t[r]>>0).toString();i.length<2&&(i="0"+i),e%=t[r],n.push(i)}var o=e.toString();if(o.length<3)for(r=0;r<=3-o.length;r++)o="0"+o;return n.join(":")+","+o};return e}();"object"==typeof n&&(t.exports=r)},{}]},{},[1])(1)});